# ----------------------------------------------------------------------
# installallpkgs.R
# ----------------------------------------------------------------------
#
# This script attempts to find all of the R packages used in all
# of the R presentation files in the lecture_notes working folder and then 
# attempts to install them using "biocLite". Note that 1-2 packages will have to be
# installed manually from github (specific instructions will be provided during the lectures)
#
# The idea is to download the course materials with "git clone", then
# run this script to install all of the packages used in presentation files
# so that the slides will display properly when run using, e.g., RStudio.
# Since many of the presentaions do not include installation commands 
# for all of the required packages, the slides may not display properly
# without installing packages beforehand.
#
# Usage: 
#
#   1. Use setwd() to set the working directory to the folder containing
#      the R script and R presentation files (i.e. SISBD/lecture_notes)
#
#   2. Run this command: source("installallpkgs.R")
#      ... where you should use the actual file path to this script.
#
# Author: Brian High with modification from Raphael Gottardo
# Date: 2014-12-27
# License: http://creativecommons.org/licenses/by-sa/3.0/deed.en_US

# Compile a list of Rpres and Rmd filenames in the current directory
# Tip: Use pattern="*.(Rpres|R|Rmd)" to also check *.R scripts.
filenames <- list.files(".", pattern = "*.Rmd", full.names = FALSE)

# Parse each file to find the packages used and compile into a list
allpkgs <- c()
for (filename in filenames) {
    pkgs <- readLines(filename, warn = FALSE)
    pkgs <- unlist(strsplit(x = pkgs, split = ";[ ]*"))
    pkgs <- pkgs[grepl("(library|require|install\\.packages|biocLite)\\(", pkgs)]
    pkgs <- gsub(".*\\((.*)\\).*", "\\1", pkgs)
    pkgs <- unlist(strsplit(x = pkgs, split = ",[ ]*"))
    pkgs <- gsub('["()]', "", pkgs)
    pkgs <- unique(pkgs[!grepl("=", pkgs)])
    allpkgs <- c(allpkgs,pkgs)
}

# Remove duplicates
allpkgs <- unique(allpkgs)

# Save a copy of the package list
write(allpkgs, "packages_list.txt")

# Install all packages using biocLite. 
# * biocLite can pull packages from Bioconductor and CRAN
source("http://bioconductor.org/biocLite.R")
biocLite(allpkgs, ask = FALSE)
